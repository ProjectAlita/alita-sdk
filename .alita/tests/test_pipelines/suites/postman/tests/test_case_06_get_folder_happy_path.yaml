name: "PST06 - get_folder: Retrieve folder in flattened format"
priority: Critical
description: |
  Validates that the get_folder tool successfully retrieves a specific folder
  in flattened format with path-based structure.
  
  Objective: Verify folder retrieval with flattened structure
  
  Expected Behavior:
  - Test folder is created successfully  
  - get_folder retrieves the folder details
  - Returns folder in flattened format
  - Contains folder metadata (name, path, description)
  - Folder is cleaned up after test

toolkits:
  - id: ${POSTMAN_TOOLKIT_ID}
    name: ${POSTMAN_TOOLKIT_NAME}

state:
  folder_name:
    type: str
  folder_description:
    type: str
    value: "Test folder created by PST06 for folder retrieval testing"
  create_result:
    type: str
  folder_path:
    type: str
  get_result:
    type: str
  delete_result:
    type: str
  test_results:
    type: dict

entry_point: prepare_test_data

nodes:
  - id: prepare_test_data
    type: code
    code:
      type: fixed
      value: |
        import time
        import random
        import string
        
        # Generate unique folder name
        timestamp = time.strftime('%Y%m%d-%H%M%S')
        random_suffix = ''.join(random.choices(string.ascii_lowercase + string.digits, k=4))
        folder_name = f"PST06_TestFolder_{timestamp}_{random_suffix}"
        
        {"folder_name": folder_name, "folder_path": folder_name}
    output:
      - folder_name
      - folder_path
    structured_output: true
    transition: create_test_folder

  - id: create_test_folder
    type: toolkit
    toolkit_name: ${POSTMAN_TOOLKIT_NAME}
    tool: create_folder
    input:
      - folder_name
      - folder_description
    input_mapping:
      name:
        type: variable
        value: folder_name
      description:
        type: variable
        value: folder_description
    output:
      - create_result
    structured_output: true
    transition: get_folder

  - id: get_folder
    type: toolkit
    toolkit_name: ${POSTMAN_TOOLKIT_NAME}
    tool: get_folder
    input:
      - folder_path
    input_mapping:
      folder_path:
        type: variable
        value: folder_path
    output:
      - get_result
    structured_output: true
    transition: validate_results

  - id: validate_results
    type: llm
    model: ${DEFAULT_LLM_MODEL}
    input:
      - create_result
      - get_result
      - folder_name
      - folder_description
    input_mapping:
      chat_history:
        type: fixed
        value: []
      system:
        type: fixed
        value: "You are a strict quality assurance validator. Only return valid JSON."
      task:
        type: fstring
        value: |
          Analyze the output from Postman folder operations.
          
          Folder Creation Result: {create_result}
          Get Folder Result: {get_result}
          Expected Folder Name: {folder_name}
          Expected Description: {folder_description}
          
          This is a POSITIVE test - we expect successful folder creation and retrieval.
          
          Validation Criteria (ALL must pass for test_passed=true):
          1. folder_created: Folder was created successfully (no errors in create_result)
          2. folder_retrieved: get_folder returned folder details successfully
          3. correct_name: Folder name matches expected name
          4. has_description: Folder description is present
          5. flattened_format: Result is in flattened format (contains path information)
          6. no_errors: No error indicators in any output
          
          Return JSON test_results:
          {{
            "test_passed": boolean (true only if ALL criteria pass),
            "folder_created": boolean,
            "folder_retrieved": boolean,
            "correct_name": boolean,
            "has_description": boolean,
            "flattened_format": boolean,
            "no_errors": boolean,
            "summary": "brief description of outcome",
            "error": string | null
          }}
          
          Return ONLY the JSON object. No markdown formatting.
    output:
      - test_results
    structured_output_dict:
      test_results: dict
    transition: cleanup_delete_folder

  - id: cleanup_delete_folder
    type: toolkit
    continue_on_error: true
    toolkit_name: ${POSTMAN_TOOLKIT_NAME}
    tool: delete_folder
    input:
      - folder_path
    input_mapping:
      folder_path:
        type: variable
        value: folder_path
    output:
      - delete_result
    structured_output: true
    transition: END
