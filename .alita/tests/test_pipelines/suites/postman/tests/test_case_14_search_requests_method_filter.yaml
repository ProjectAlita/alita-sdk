name: "PST14 search requests method"
priority: High
description: |
  Validates that the search_requests tool properly applies HTTP method filters
  when searching for requests.
  
  Objective: Verify request search with method filtering
  
  Expected Behavior:
  - Tool executes successfully
  - Returns only requests matching the specified HTTP method
  - Filters work in combination with search query
  - Results exclude requests with different methods

toolkits:
  - id: ${TOOLKIT_ID}
    name: ${TOOLKIT_NAME}

state:
  tool_result:
    type: dict
  test_results:
    type: dict
  search_query:
    type: str
    value: "user"
  search_in:
    type: str
    value: "all"
  method:
    type: str
    value: "POST"
entry_point: invoke_search_requests

nodes:
  - id: invoke_search_requests
    type: toolkit
    toolkit_name: ${TOOLKIT_NAME}
    tool: search_requests
    input:
      - search_query
      - search_in
      - method
    input_mapping:
      query:
        type: variable
        value: search_query
      search_in:
        type: variable
        value: search_in
      method:
        type: variable
        value: method
    output:

      - tool_result
    structured_output: true
    transition: process_results

  - id: process_results
    type: llm
    model: gpt-4o-2024-11-20
    input:
      - tool_result
    input_mapping:
      system:
        type: fixed
        value: "You are a quality assurance validator."
      task:
        type: fstring
        value: |
          Analyze the output from the 'search_requests' tool with method filtering.
          
          Tool Result: {tool_result}
          
          This test validates that search_requests filters by HTTP method.
          
          Perform the following checks:
          1. Confirm the tool executed successfully.
          2. Verify the result contains filtered search results.
          3. Check that results only include POST method requests if applicable.
          4. Validate the method filter was properly applied.
          
          Return a JSON object named test_results with the following structure:
          
          {{
            "test_passed": boolean (true if search with method filter executed successfully),
            "summary": "brief description of outcome",
            "error": "error details if failed, null if passed"
          }}
          
          Return **ONLY** the JSON object. No markdown formatting, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
