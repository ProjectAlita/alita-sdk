name: "PST11 get request script happy"
priority: Critical
description: |
  Validates that the get_request_script tool successfully retrieves test or
  pre-request script content from a specific request.
  
  Objective: Verify script content retrieval
  
  Expected Behavior:
  - Tool executes successfully
  - Returns script content for the specified request
  - Script type (test or pre-request) is clearly indicated
  - Script content is properly formatted

toolkits:
  - id: ${TOOLKIT_ID}
    name: ${TOOLKIT_NAME}

state:
  tool_result:
    type: dict
  test_results:
    type: dict
  request_path:
    type: str
    value: ${TEST_REQUEST_PATH}
  script_type:
    type: str
    value: "test"
entry_point: invoke_get_request_script

nodes:
  - id: invoke_get_request_script
    type: toolkit
    toolkit_name: ${TOOLKIT_NAME}
    tool: get_request_script
    input:
      - request_path
      - script_type
    input_mapping:
      request_path:
        type: variable
        value: request_path
      script_type:
        type: variable
        value: script_type
    output:

      - tool_result
    structured_output: true
    transition: process_results

  - id: process_results
    type: llm
    model: gpt-4o-2024-11-20
    input:
      - tool_result
    input_mapping:
      system:
        type: fixed
        value: "You are a quality assurance validator."
      task:
        type: fstring
        value: |
          Analyze the output from the 'get_request_script' tool.
          
          Tool Result: {tool_result}
          
          This test validates that get_request_script returns script content.
          
          Perform the following checks:
          1. Confirm the tool executed successfully.
          2. Verify the result contains script content or indication of no scripts.
          3. Check that the script type is properly identified.
          4. Validate the response structure is appropriate.
          
          Return a JSON object named test_results with the following structure:
          
          {{
            "test_passed": boolean (true if script content was retrieved),
            "summary": "brief description of outcome",
            "error": "error details if failed, null if passed"
          }}
          
          Return **ONLY** the JSON object. No markdown formatting, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
