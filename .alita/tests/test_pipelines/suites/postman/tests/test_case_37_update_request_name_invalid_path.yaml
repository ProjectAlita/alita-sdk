name: "PST37 update request name"
priority: High
description: |
  Validates that the update_request_name tool properly handles attempts to update
  a request that doesn't exist or has an invalid path.
  
  Objective: Verify error handling for invalid request paths
  
  Expected Behavior:
  - Tool executes without crashing
  - Returns appropriate error message
  - Error indicates request not found

toolkits:
  - id: ${TOOLKIT_ID}
    name: ${TOOLKIT_NAME}

state:
  tool_result:
    type: dict
  test_results:
    type: dict
  invalid_request_path:
    type: str
    value: "Invalid/Request/Path"
  new_name:
    type: str
    value: "Updated Name"
entry_point: invoke_update_request_name

nodes:
  - id: invoke_update_request_name
    type: toolkit
    toolkit_name: ${TOOLKIT_NAME}
    tool: update_request_name
    input:
      - invalid_request_path
      - new_name
    input_mapping:
      request_path:
        type: variable
        value: invalid_request_path
      name:
        type: variable
        value: new_name
    output:

      - tool_result
    structured_output: true
    transition: process_results

  - id: process_results
    type: llm
    model: gpt-4o-2024-11-20
    input:
      - tool_result
    input_mapping:
      system:
        type: fixed
        value: "You are a quality assurance validator."
      task:
        type: fstring
        value: |
          Analyze the output from the 'update_request_name' tool with invalid path.
          
          Tool Result: {tool_result}
          
          This test validates error handling for invalid request paths.
          
          Perform the following checks:
          1. Confirm the tool executed (result is not empty or null).
          2. Examine any error message for specific meaning. Valid error patterns include:
             - request not found or does not exist
             - invalid request path
             - request path cannot be located
             - no request at specified path
          3. Determine if the error is about the invalid path itself.
             Errors like "request not found" are expected and correct.
             System errors unrelated to the invalid path are failures.
          
          Return a JSON object named test_results with the following structure:
          
          {{
            "test_passed": boolean (true if appropriate error was returned for invalid path),
            "summary": "brief description of outcome",
            "error": "error details if failed, null if passed"
          }}
          
          Return **ONLY** the JSON object. No markdown formatting, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
