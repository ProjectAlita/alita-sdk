name: "PST23 update collection auth"
priority: Critical
description: |
  Validates that the update_collection_auth tool successfully updates
  collection-level authentication settings.
  
  Objective: Verify collection authentication update functionality
  
  Expected Behavior:
  - Tool executes successfully
  - Collection authentication is updated
  - Auth settings include type and credentials
  - Returns confirmation of the update

toolkits:
  - id: ${TOOLKIT_ID}
    name: ${TOOLKIT_NAME}

state:
  tool_result:
    type: dict
  test_results:
    type: dict
  auth:
    type: dict
    value:
      type: "bearer"
      bearer:
        - key: "token"
          value: "test_token"
          type: "string"

entry_point: invoke_update_collection_auth

nodes:
  - id: invoke_update_collection_auth
    type: toolkit
    toolkit_name: ${TOOLKIT_NAME}
    tool: update_collection_auth
    input:
      - auth
    input_mapping:
      auth:
        type: variable
        value: auth
    output:

      - tool_result
    structured_output: true
    transition: process_results

  - id: process_results
    type: llm
    model: gpt-4o-2024-11-20
    input:
      - tool_result
    input_mapping:
      system:
        type: fixed
        value: "You are a quality assurance validator."
      task:
        type: fstring
        value: |
          Analyze the output from the 'update_collection_auth' tool.
          
          Tool Result: {tool_result}
          
          This test validates that update_collection_auth updates authentication settings.
          
          Perform the following checks:
          1. Confirm the tool executed successfully.
          2. Verify the result indicates authentication was updated.
          3. Check for success confirmation or updated collection data.
          4. Validate the auth structure was properly processed.
          
          Return a JSON object named test_results with the following structure:
          
          {{
            "test_passed": boolean (true if authentication was updated successfully),
            "summary": "brief description of outcome",
            "error": "error details if failed, null if passed"
          }}
          
          Return **ONLY** the JSON object. No markdown formatting, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
