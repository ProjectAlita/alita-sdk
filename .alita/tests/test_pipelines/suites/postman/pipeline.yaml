suite_name: postman
description: Test suite for Postman toolkit

# Environment variable mappings
env_mapping:
  api_key: ${POSTMAN_API_KEY}
  workspace_id: ${POSTMAN_WORKSPACE_ID}
  test_collection_id: ${POSTMAN_TEST_COLLECTION_ID}
  base_url: ${POSTMAN_BASE_URL:https://api.getpostman.com}

# Setup steps executed before running tests
setup:
  # Step 1: Ensure Postman credentials configuration exists
  - name: Setup Postman Configuration
    type: configuration
    config:
      config_type: postman
      alita_title: ${POSTMAN_SECRET_NAME:postman}
      data:
        api_key: ${POSTMAN_API_KEY}
        base_url: ${POSTMAN_BASE_URL:https://api.getpostman.com}
        workspace_id: ${POSTMAN_WORKSPACE_ID}

  # Step 2: Create or update the Postman toolkit on the platform
  - name: Create Postman Toolkit
    type: toolkit
    action: create_or_update
    config:
      config_file: ../../configs/postman-config.json
      toolkit_type: postman
      overrides:
        postman_configuration:
          private: true
          alita_title: ${POSTMAN_SECRET_NAME:postman}
        collection_id: ${POSTMAN_TEST_COLLECTION_ID}
        workspace_id: ${POSTMAN_WORKSPACE_ID}
        base_url: ${POSTMAN_BASE_URL:https://api.getpostman.com}
        environment_config:
          base_url: ${POSTMAN_ENV_BASE_URL:https://api.example.com}
          api_key: ${POSTMAN_ENV_API_KEY:test_api_key}
      toolkit_name: ${POSTMAN_TOOLKIT_NAME:testing}
    save_to_env:
      - key: TOOLKIT_ID
        value: $.id
      - key: TOOLKIT_NAME
        value: $.name

  # Step 3: Create test folder in collection
  - name: Create Test Folder
    type: toolkit_invoke
    enabled: true
    config:
      toolkit_id: ${TOOLKIT_ID}
      tool_name: create_folder
      tool_params:
        name: "Test_Folder"
        description: "Folder for automated testing"
    continue_on_error: false
    save_to_env:
      - key: TEST_FOLDER_PATH
        value: "Test_Folder"

  # Step 4: Create test request in folder
  - name: Create Test Request
    type: toolkit_invoke
    enabled: true
    config:
      toolkit_id: ${TOOLKIT_ID}
      tool_name: create_request
      tool_params:
        folder_path: "Test_Folder"
        name: "Test_API_Request"
        method: "GET"
        url: "https://api.example.com/test"
    continue_on_error: false
    save_to_env:
      - key: TEST_REQUEST_PATH
        value: "Test_Folder/Test_API_Request"

  # # Step 5: Create target folder for move operations
  # - name: Create Target Folder
  #   type: toolkit_invoke
  #   enabled: true
  #   config:
  #     toolkit_id: ${TOOLKIT_ID}
  #     tool_name: create_folder
  #     tool_params:
  #       name: "Target Folder"
  #       description: "Target folder for move operations"
  #   continue_on_error: false
  #   save_to_env:
  #     - key: TARGET_FOLDER_PATH
  #       value: "Target Folder"

# Execution configuration
execution:
  test_directory: tests
  test_pattern: "test_case_*.yaml"
  parallel: false
  substitutions:
    TOOLKIT_ID: ${TOOLKIT_ID}
    TOOLKIT_NAME: ${TOOLKIT_NAME}
    TIMESTAMP: ${TIMESTAMP}
    TEST_COLLECTION_ID: ${POSTMAN_TEST_COLLECTION_ID}
    TEST_FOLDER_PATH: ${TEST_FOLDER_PATH}
    TEST_FOLDER_ID: ${TEST_FOLDER_ID}
    TEST_REQUEST_PATH: ${TEST_REQUEST_PATH}
    # TEST_REQUEST_ID: ${TEST_REQUEST_ID}
    # TARGET_FOLDER_PATH: ${TARGET_FOLDER_PATH}
    # TARGET_FOLDER_ID: ${TARGET_FOLDER_ID}

# Cleanup steps executed after tests complete
cleanup:
  # Delete created test artifacts
  - name: Delete Test Collection Copy
    type: toolkit_invoke
    enabled: false  # Set to true if delete_collection tool is enabled
    config:
      toolkit_id: ${TOOLKIT_ID}
      tool_name: delete_collection
      tool_params:
        collection_id: ${TEST_COLLECTION_ID}
    continue_on_error: true

  # Delete the test toolkit from platform
  - name: Delete Test Toolkit
    type: toolkit
    action: delete
    config:
      toolkit_id: ${TOOLKIT_ID}
