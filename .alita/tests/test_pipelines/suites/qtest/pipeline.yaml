name: qtest_toolkit
description: |
  QTest toolkit integration tests

  Test Structure:
  - Search Operations (QT01-QT02): Test DQL search and field retrieval
  - Test Case CRUD Operations (QT03-QT05): Create, retrieve, and update test cases
  - Module Operations (QT06): Test module hierarchy retrieval
  - Attachment Operations (QT07): Test file attachments
  - Relationship Operations (QT08): Test case-requirement relationships

env_mapping:
  toolkit_config: ${QTEST_CONFIG_PATH:../../configs/qtest-config.json}
  base_url: ${QTEST_BASE_URL:https://alita.qtestnet.com}
  qtest_api_token: ${QTEST_API_TOKEN}
  qtest_project_id: ${QTEST_PROJECT_ID:1}

setup:
  - name: Setup QTest Configuration
    type: configuration
    config:
      config_type: qtest
      alita_title: ${QTEST_SECRET_NAME:qtest}
      data:
        base_url: ${QTEST_BASE_URL:https://alita.qtestnet.com}
        qtest_api_token: ${QTEST_API_TOKEN}

  - name: Create QTest Toolkit
    type: toolkit
    action: create_or_update
    config:
      config_file: ${QTEST_CONFIG_PATH:../../configs/qtest-config.json}
      toolkit_type: qtest
      toolkit_name: ${QTEST_TOOLKIT_NAME:qtest-testing}
    save_to_env:
      - key: QTEST_TOOLKIT_ID
        value: $.id
      - key: QTEST_TOOLKIT_NAME
        value: $.name

composable_pipelines: []

execution:
  test_directory: .
  order:
    - test_case_*.yaml  
  
  substitutions:
    QTEST_TOOLKIT_ID: ${QTEST_TOOLKIT_ID}
    QTEST_TOOLKIT_NAME: ${QTEST_TOOLKIT_NAME}
    QTEST_PROJECT_ID: ${QTEST_PROJECT_ID:1}
    TIMESTAMP: ${TIMESTAMP}
    DEFAULT_LLM_MODEL: ${DEFAULT_LLM_MODEL:gpt-4o-2024-11-20}

  settings:
    timeout: 180
    parallel: 1
    stop_on_failure: false

exclude_tests: []

cleanup:
  - name: Delete Test Pipelines
    type: pipeline
    config:
      pattern: "QT*"
    continue_on_error: true

  - name: Delete Created Test Cases
    type: custom
    script: |
      # Cleanup created test cases if they exist in state
      if [ -n "$CREATED_TEST_QT_ID" ]; then
        echo "Cleaning up test case: $CREATED_TEST_QT_ID"
        # The delete_test_case tool will be called during pipeline cleanup
      fi
    continue_on_error: true

  - name: Delete QTest Toolkit
    type: toolkit
    config:
      toolkit_id: ${QTEST_TOOLKIT_ID}
    enabled: true
    continue_on_error: true
