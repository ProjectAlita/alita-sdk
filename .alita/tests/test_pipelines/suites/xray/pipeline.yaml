name: xray_toolkit
description: |
  Xray Cloud toolkit integration tests

  Test Structure:
  - GraphQL Query Operations (XR01-XR02): Test basic GraphQL execution and test retrieval
  - Test Creation Operations (XR03-XR04): Test creation with different test types
  - Attachment Operations (XR05-XR06): Test attachment management for test steps

env_mapping:
  XRAY_CONFIG_PATH: ${XRAY_CONFIG_PATH:../../configs/xray-config.json}
  XRAY_BASE_URL: ${XRAY_BASE_URL:https://eu.xray.cloud.getxray.app}
  XRAY_CLIENT_ID: ${XRAY_CLIENT_ID}
  XRAY_CLIENT_SECRET: ${XRAY_CLIENT_SECRET}
  XRAY_PROJECT_KEY: ${XRAY_PROJECT_KEY:EL}

setup:
  - name: Setup Xray Configuration
    type: configuration
    config:
      config_type: xray
      alita_title: ${XRAY_SECRET_NAME:xray_cloud}
      data:
        base_url: ${XRAY_BASE_URL:https://eu.xray.cloud.getxray.app}
        client_id: ${XRAY_CLIENT_ID}
        client_secret: ${XRAY_CLIENT_SECRET}

  - name: Create Xray Toolkit
    type: toolkit
    action: create_or_update
    config:
      config_file: ${XRAY_CONFIG_PATH:../../configs/xray-config.json}
      toolkit_type: xray_cloud
      overrides:
        xray_configuration:
          private: false
          alita_title: ${XRAY_SECRET_NAME:xray_cloud}
      toolkit_name: ${XRAY_TOOLKIT_NAME:xray-testing}
    save_to_env:
      - key: XRAY_TOOLKIT_ID
        value: $.id
      - key: XRAY_TOOLKIT_NAME
        value: $.name

composable_pipelines: []

execution:
  test_directory: tests
  order:
    - test_case_*.yaml  
  
  substitutions:
    XRAY_TOOLKIT_ID: ${XRAY_TOOLKIT_ID}
    XRAY_TOOLKIT_NAME: ${XRAY_TOOLKIT_NAME}
    XRAY_PROJECT_KEY: ${XRAY_PROJECT_KEY:EL}
    TIMESTAMP: ${TIMESTAMP}
    DEFAULT_LLM_MODEL: ${DEFAULT_LLM_MODEL:gpt-4o-2024-11-20}

  settings:
    timeout: 180
    parallel: 1
    stop_on_failure: false

exclude_tests: []

cleanup:
  - name: Delete Test Pipelines
    type: pipeline
    config:
      pattern: "XR*"
    continue_on_error: true

  - name: Delete Xray Toolkit
    type: toolkit
    config:
      toolkit_id: ${XRAY_TOOLKIT_ID}
    enabled: true
    continue_on_error: true
