name: "JR04 - Create Issue (Invalid Project)"
priority: High
description: |
  Verify `create_issue` tool handles invalid project gracefully.

  Objective: Ensure tool returns error for non-existent project key.

  Expected Behavior:
  - Tool executes and handles error appropriately.
  - Returns error message or exception for invalid project.

toolkits:
  - id: ${JIRA_TOOLKIT_ID}
    name: ${JIRA_TOOLKIT_NAME}

state:
  issue_json:
    type: str
    value: '{"fields": {"project": {"key": "INVALIDPROJ99999"}, "summary": "Test Issue", "issuetype": {"name": "Task"}}}'
  tool_result:
    type: str
  test_results:
    type: dict

entry_point: invoke_create_issue

nodes:
  - id: invoke_create_issue
    type: toolkit
    tool: create_issue
    toolkit_name: ${JIRA_TOOLKIT_NAME}
    input:
      - issue_json
    input_mapping:
      issue_json:
        type: variable
        value: issue_json
    output:
      - tool_result
    structured_output: true
    transition: process_results

  - id: process_results
    type: llm
    model: gpt-4o
    input:
      - tool_result
    input_mapping:
      system:
        type: fixed
        value: "You are a quality assurance validator."
      task:
        type: fstring
        value: |
          Analyze the output from the 'create_issue' tool.

          Tool Result: {tool_result}

          Perform the following checks:
          1. Tool should return an error for invalid project key.
          2. Error message should contain "valid project is required" or similar validation error.
          3. Tool should handle the error gracefully (no crash/exception).

          Test passes if:
          - Error message contains "valid project is required" or "project" related error
          - Tool did not crash
          - Error is returned as expected for invalid project

          Return a JSON object named test_results with the following structure:

          {{
            "test_passed": boolean,
            "summary": "Brief description of outcome",
            "error": "Error details if failed, null if passed"
          }}

          Return **ONLY** the JSON object. No markdown, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
