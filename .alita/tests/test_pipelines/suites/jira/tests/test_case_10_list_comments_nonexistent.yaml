name: "JR10 - List Comments (Non-existent Issue)"
priority: High
description: |
  Verify `list_comments` tool handles non-existent issue gracefully.

  Objective: Ensure tool returns error for invalid issue key.

  Expected Behavior:
  - Tool executes and handles error appropriately.

toolkits:
  - id: ${JIRA_TOOLKIT_ID}
    name: ${JIRA_TOOLKIT_NAME}

state:
  issue_key:
    type: str
    value: "INVALID-99999"
  tool_result:
    type: str
  test_results:
    type: dict

entry_point: invoke_list_comments

nodes:
  - id: invoke_list_comments
    type: toolkit
    tool: list_comments
    toolkit_name: ${JIRA_TOOLKIT_NAME}
    input:
      - issue_key
    input_mapping:
      issue_key:
        type: variable
        value: issue_key
    output:
      - tool_result
    structured_output: true
    continue_on_error: true
    transition: process_results

  - id: process_results
    type: llm
    model: ${DEFAULT_LLM_MODEL}
    input:
      - tool_result
    input_mapping:
      system:
        type: fixed
        value: "You are a quality assurance validator."
      task:
        type: fstring
        value: |
          Analyze the output from the 'list_comments' tool.

          Tool Result: {tool_result}

          This test validates error handling for non-existent issues.

          Perform the following checks:
          1. Confirm the tool executed (result is not empty or null).
          2. Examine any error message for specific meaning. Valid error patterns for invalid issues include:
             - issue key does not exist or is invalid
             - issue not found or cannot be accessed
             - insufficient permissions to view the issue
             - http error codes 404 (not found) or 403 (forbidden)
          3. Determine if the error is about the invalid issue itself. Errors like "INVALID-99999 does not exist" or "Issue does not exist or you do not have permission to see it" are expected and correct. System errors unrelated to the invalid issue key are failures.

          Return a JSON object named test_results with the following structure:

          {{
            "test_passed": boolean,
            "summary": "Brief description of what the tool returned",
            "error": "Error message if any, null otherwise",
            "explanation": "Why the test passed or failed based on the error meaning"
          }}

          Return **ONLY** the JSON object. No markdown, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
