name: "FIG04 - Get File with Geometry"
description: "Test get_file with geometry parameter to export vector data"

toolkits:
  - id: ${FIGMA_TOOLKIT_ID}
    name: ${FIGMA_TOOLKIT_NAME}

state:
  file_key:
    type: str
    value: "qhfjaNs21EVUVlBiBejzPH"
  geometry_param:
    type: str
    value: "paths"
  test_results:
    type: dict
  tool_result:
    type: dict

entry_point: invoke_get_file_with_geometry

nodes:
  - id: invoke_get_file_with_geometry
    type: toolkit
    input:
      - file_key
      - geometry_param
    input_mapping:
      file_key:
        type: variable
        value: file_key
      geometry:
        type: variable
        value: geometry_param
    output:
      - tool_result
    structured_output: true
    tool: get_file
    toolkit_name: ${FIGMA_TOOLKIT_NAME}
    transition: validate_geometry_data

  - id: validate_geometry_data
    type: llm
    input:
      - tool_result
    input_mapping:
      chat_history:
        type: fixed
        value: []
      system:
        type: fixed
        value: You are a quality assurance validator for Figma API vector data testing.
      task:
        type: fstring
        value: |-
          Analyze the output from 'get_file' when called with geometry='paths' parameter.

          Tool Output: {tool_result}

          Validation Criteria:
          1. Tool Execution: Confirm the tool executed successfully
          2. Basic Structure: Verify standard file structure is present (document, name, version)
          3. Geometry Data: Check for presence of vector/path data in nodes:
             - Look for 'fillGeometry' or 'strokeGeometry' arrays in shape nodes
             - These arrays should contain path data if vectors are present
             - Not all nodes will have geometry (only vector shapes)
          4. Data Format: If geometry is present, it should be in array format with path commands

          Note: Not all files contain vector data, so absence of geometry is not a failure if the file structure is valid.

          Return a JSON object named test_results with this EXACT structure:
          {
            "test_passed": boolean,
            "tool_executed": boolean,
            "operation_succeeded": boolean,
            "file_structure_valid": boolean,
            "geometry_data_found": boolean,
            "error": string or null,
            "message_snippet": "Brief summary of geometry export result"
          }

          IMPORTANT: Return ONLY the test_results JSON object, no additional text.
    model: ${DEFAULT_LLM_MODEL:gpt-4o}
    output:
      - test_results
    structured_output_dict:
      test_results: dict
    transition: END