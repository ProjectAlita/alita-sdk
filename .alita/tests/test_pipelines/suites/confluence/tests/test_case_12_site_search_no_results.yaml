name: "CF12 - Site Search (No Results)"
priority: High
description: |
  Verify `site_search` tool handles queries with no matching pages gracefully.

  Objective: Ensure tool returns appropriate message when no results found.

  Expected Behavior:
  - Tool executes without throwing errors.
  - Returns message starting with "Unable to find anything using query" when no matches exist.

toolkits:
  - id: ${CONFLUENCE_TOOLKIT_ID}
    name: ${CONFLUENCE_TOOLKIT_NAME}

state:
  query:
    type: str
    value: "xyznonexistentquery123456789"
  tool_result:
    type: str
  test_results:
    type: dict

entry_point: invoke_site_search

nodes:
  - id: invoke_site_search
    type: toolkit
    tool: site_search
    toolkit_name: ${CONFLUENCE_TOOLKIT_NAME}
    input:
      - query
    input_mapping:
      query:
        type: variable
        value: query
    output:
      - tool_result
    structured_output: true
    transition: process_results

  - id: process_results
    type: llm
    model: gpt-4o
    input:
      - tool_result
      - query
    input_mapping:
      system:
        type: fixed
        value: "You are a quality assurance validator."
      task:
        type: fstring
        value: |
          Analyze the output from the 'site_search' tool.

          Tool Result: {tool_result}
          Query: {query}

          Perform the following checks:
          1. Confirm the tool executed without throwing errors.
          2. Verify the result contains message "Unable to find anything using query" when no results found.
          3. Tool should not crash or return null/empty string.

          Return a JSON object named test_results with the following structure:

          {{
            "test_passed": boolean,
            "summary": "Brief description of outcome",
            "error": "Error details if failed, null if passed"
          }}

          Return **ONLY** the JSON object. No markdown, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
