name: "SP10 - get_files_list: Folder filtering"
priority: High
description: |
  Verify the SharePoint 'get_files_list' tool filters files by folder path.
  
  Objective: Test folder-specific file listing functionality
  
  Expected Behavior:
  - Tool executes successfully without errors
  - Returns only files from specified folder
  - Supports both relative and absolute folder paths
  - Empty folder returns empty array (not error)
  - Form name filtering works correctly

toolkits:
  - id: ${SHAREPOINT_TOOLKIT_ID}
    name: ${SHAREPOINT_TOOLKIT_NAME}

state:
  folder_name:
    type: str
    value: ${TEST_FOLDER}
  limit_files:
    type: int
    value: 20
  files_result:
    type: dict
  error_indicators:
    type: list
    value: ["error", "failed", "exception", "permission denied"]
  test_results:
    type: dict

entry_point: invoke_get_files_list

nodes:
  - id: invoke_get_files_list
    type: toolkit
    tool: get_files_list
    toolkit_name: ${SHAREPOINT_TOOLKIT_NAME}
    input:
      - folder_name
      - limit_files
    input_mapping:
      folder_name:
        type: variable
        value: folder_name
      limit_files:
        type: variable
        value: limit_files
    output:
      - files_result
    structured_output: true
    transition: validate_result

  - id: validate_result
    type: llm
    model: gpt-4o-2024-11-20
    input:
      - files_result
      - folder_name
      - error_indicators
    input_mapping:
      system:
        type: fixed
        value: "you are a quality assurance validator."
      task:
        type: fstring
        value: |
          analyze the output from the 'get_files_list' tool execution.

          tool executed: get_files_list
          folder: {folder_name}
          results: {files_result}
          error indicators: {error_indicators}

          expected behavior:
          - tool executes successfully without errors
          - returns array of file objects (can be empty if folder is empty)
          - if files returned, paths should contain the folder name
          - no critical errors or exceptions
          - empty folder returns empty array, not error

          evaluate:
          1. did the tool execute successfully?
          2. are there any critical error indicators in the output?
          3. is the result an array (even if empty)?
          4. if files returned, do paths include the specified folder?
          5. is the response structure valid?

          note: if the folder does not exist or is empty, an empty array or appropriate message is acceptable.

          return a json object with:
          {{
            "test_passed": true/false,
            "summary": "brief description of outcome",
            "error": "error details if failed, null if passed"
          }}

          return **only** the json object. no markdown formatting, no additional text.
      chat_history:
        type: fixed
        value: []
    output:
      - test_results
    structured_output_dict:
      test_results: "dict"
    transition: END
