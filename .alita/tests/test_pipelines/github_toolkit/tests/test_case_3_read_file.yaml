name: "GH3 - Read File"
description: "Verify read_file tool retrieves file content from repository"

toolkits:
  - id: ${GITHUB_TOOLKIT_ID}
    name: ${GITHUB_TOOLKIT_NAME}

state:
  input:
    type: str
  messages:
    type: list
  file_path:
    type: str
    value: ".gitignore"
  expected_content:
    type: str
    value: ".DS_Store"
  tool_result:
    type: str
  test_results:
    type: dict

entry_point: invoke_read_file

nodes:
  - id: invoke_read_file
    type: toolkit
    tool: read_file
    toolkit_name: ${GITHUB_TOOLKIT_NAME}
    input:
      - file_path
    input_mapping:
      file_path:
        type: variable
        value: file_path
    output:
      - tool_result
    structured_output: true
    transition: process_results

  - id: process_results
    type: code
    code:
      type: fixed
      value: |
        # Process the result from toolkit node
        file_content = alita_state.get('tool_result')
        file_path = alita_state.get('file_path', '.gitignore')
        expected_content = alita_state.get('expected_content', '.DS_Store')

        tool_executed = file_content is not None
        error_message = None

        # Verify content
        content_valid = False
        has_expected = False
        if file_content and isinstance(file_content, str):
            content_valid = len(file_content) > 0
            has_expected = expected_content in file_content if expected_content else True

        test_results = {
            "test_passed": tool_executed and content_valid and has_expected,
            "tool_executed": tool_executed,
            "file_path": file_path,
            "content_length": len(file_content) if file_content else 0,
            "content_valid": content_valid,
            "has_expected_content": has_expected,
            "content_preview": file_content[:300] if file_content else None,
            "error": error_message
        }
        test_results
        # Add results to messages
    input:
      - file_path
      - expected_content
      - tool_result
    output:
      - messages
    structured_output: false
    transition: END
